import React, { useState, useEffect} from 'react';
import EyeComponent from './EyeComponent';

//interface that specifies values passed into the component
interface FaceProps {
  headClicked: boolean;
}

//main component of the face
function FaceComponent(props: FaceProps) {
  const [nosePosition, setNosePosition] = useState({ x: 0, y: 0 });
  const [mouthPosition, setMouthPosition] = useState({ x: 0, y: 0 });
  const [browPosition, setBrowPosition] = useState({ x: 0, y: 0 });
  

// setting up the event listeners and components
  useEffect(() => {
    const container = document.querySelector('.head-container') as HTMLElement;
    const nose = document.querySelector('.nose') as HTMLElement;
    const mouth = document.querySelector('.mouth') as HTMLElement;
    const leftbrow = document.querySelector('.leftbrow') as HTMLElement;
    const rightbrow = document.querySelector('.rightbrow') as HTMLElement;
  
    if (container && nose && mouth && leftbrow && rightbrow) {
      document.addEventListener('mousemove', updateLocation);
      container.addEventListener('mouseenter', handleMouseEnter);
      container.addEventListener('mouseleave', handleMouseLeave);
      return () => {
        document.removeEventListener('mousemove', updateLocation);
        container.removeEventListener('mouseenter', handleMouseEnter);
        container.removeEventListener('mouseleave', handleMouseLeave);
      };
    }
  }, []);

  //method to handle mouth movement based on mouse movement
  const handleMouseEnter = () => {
    const mouth = document.querySelector('.mouth') as HTMLElement;
    mouth.classList.remove('mouth-shrink')
    mouth.classList.add('mouth-grow')
  }

  //method to reset mouth shape when mouse leaves
  const handleMouseLeave = () => {
    const mouth = document.querySelector('.mouth') as HTMLElement;
    mouth.classList.remove('mouth-grow')
    mouth.classList.add('mouth-shrink')
  }

  //method to update location of face components based on mouse movement
  const updateLocation = (e: { clientX: number; clientY: number; }) => {
    const container = document.querySelector('.head-container') as HTMLElement;

    const containerRect = container.getBoundingClientRect();
    const scaleX = containerRect.width / window.innerWidth*0.3;
    const scaleY = containerRect.height / window.innerHeight*0.3;
    const scaledX = (e.clientX - (containerRect.left + containerRect.width/2)) * scaleX;
    const scaledY = (e.clientY - (containerRect.top + containerRect.height/2)) * scaleY;
    setNosePosition({x: scaledX, y: scaledY});
    setMouthPosition({x: scaledX, y: scaledY});
    setBrowPosition({x: scaledX, y: scaledY});
  }

  //returns the components
  return (
    <div className="face">
      <div className="upper-face">
        <div className="leftbrow" style={props.headClicked ? {} : {left: `${browPosition.x}px`, top: `${browPosition.y}px`}}></div>
        <div className="rightbrow" style={props.headClicked ? {} : {left: `${browPosition.x}px`, top: `${browPosition.y}px`}}></div>
      </div>
      <div className="mid-face">
        <div className="eye-container">
          <EyeComponent headClicked={props.headClicked}/>
        </div>
        <div className="space-between-eyes"></div>
        <div className="eye-container">
          <EyeComponent headClicked={props.headClicked}/>
        </div>
      </div>
      <div className="mid-lower-face">
        <div className="nose" style={props.headClicked ? {} : {left: `${nosePosition.x}px`, top: `${nosePosition.y}px`}}></div>
      </div>
      <div className="lower-face">
          <div className="mouth" style={props.headClicked ? {} : {left: `${mouthPosition.x}px`, top: `${mouthPosition.y}px`}}></div>
      </div>
    </div>
  );
}

export default FaceComponent;